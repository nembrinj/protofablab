<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Simon Ruffieux">
<meta name="dcterms.date" content="2025-09-25">
<meta name="keywords" content="Human-IST, ProtoFab, LearningLab, UniFR">

<title>Introduction to ROS and Turtlebot3</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="AN_02_ROS_files/libs/clipboard/clipboard.min.js"></script>
<script src="AN_02_ROS_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="AN_02_ROS_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="AN_02_ROS_files/libs/quarto-html/popper.min.js"></script>
<script src="AN_02_ROS_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="AN_02_ROS_files/libs/quarto-html/anchor.min.js"></script>
<link href="AN_02_ROS_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="AN_02_ROS_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="AN_02_ROS_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="AN_02_ROS_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="AN_02_ROS_files/libs/bootstrap/bootstrap-e45286ae55112de182af3b94459e1a1c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="..\..\..\AN_02_ROS.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Introduction to ROS and Turtlebot3</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Simon Ruffieux </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 25, 2025</p>
    </div>
  </div>
  
    
  </div>
  

<div>
  <div class="keywords">
    <div class="block-title">Keywords</div>
    <p>Human-IST, ProtoFab, LearningLab, UniFR</p>
  </div>
</div>

</header>


<section id="protofab-assignment-2-introduction-to-ros-and-turtlebot3" class="level1">
<h1>ProtoFab Assignment 2: Introduction to ROS and Turtlebot3</h1>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>This practical work focuses on learning the basic concepts of ROS through small independent tasks. Each task consists of applying hands-on commands in the terminal to illustrate how ROS and Turtlebot3 work. Note that Task 4 is the only task of this assignment where you will have to develop code on your own!</p>
<p>In this practical work, you will perform the following tasks:</p>
<ul>
<li><p><strong>Task 1</strong> – Explore ROS and Linux basic commands</p></li>
<li><p><strong>Task 2</strong> – Control the Turtlebot3 in the real world</p></li>
<li><p><strong>Task 3</strong> – Control the Turtlebot3 in simulation</p></li>
<li><p><strong>Task 4</strong> – Create your first controller <strong>(code on your own)</strong>.</p></li>
<li><p><strong>Task 5</strong> – [Optional] Update Turtlebot3 Wifi settings</p></li>
<li><p><strong>Task 6</strong> – [Optional] Enable usb_camera and live-stream on the Turtlebot3</p></li>
</ul>
<p><u><strong>Learning objectives:</strong></u></p>
<p>At the end of the assignment, you should be able to</p>
<ul>
<li><p>Run basic commands</p></li>
<li><p>Use visualization tools (rqt_graph, rqt)</p></li>
<li><p>Create a package</p></li>
<li><p>Understand Nodes and Topics (creation, start, code, etc.)</p></li>
<li><p>Use the Turtlebot3 in simulation and real modes</p></li>
<li><p>Create a simple controller for the Turtlebot3</p></li>
</ul>
</section>
<section id="pre-requesites" class="level2">
<h2 class="anchored" data-anchor-id="pre-requesites">Pre-requesites</h2>
<ul>
<li><p>A working installation of ROS (ubuntu 20.04 + ROS noetic) (see AN01)</p></li>
<li><p>Notions seen in the lecture LN02</p></li>
</ul>
</section>
<section id="hints" class="level2">
<h2 class="anchored" data-anchor-id="hints">Hints</h2>
<ol type="1">
<li><p>When you create a new workspace, do not forget to source it and, ideally, also to add the source command to your ‘~/.bashrc’ file.</p></li>
<li><p>Do not forget to make your python scripts executables (using the command chmod +x)</p></li>
<li><p>If you are using Windows WSL2 and Ubuntu, folder and file creations can be done using Visual Studio Code Interface</p>
<ol type="1">
<li>You can install code using the command “sudo snap install –classic code”. Or you can simply install the WSL plugin for your Windows VS Code to remotely handle files and folders in your WSL environment.</li>
</ol></li>
<li><p>If you are using Windows WSL2 and Ubuntu, do not forget to disable your firewalls, otherwise ROS messages are blocked. Do not forget to re-enable them after the assignments.</p></li>
</ol>
</section>
<section id="tasks" class="level2">
<h2 class="anchored" data-anchor-id="tasks">Tasks</h2>
<section id="task-1-explore-ros-basic-commands" class="level3">
<h3 class="anchored" data-anchor-id="task-1-explore-ros-basic-commands">Task 1 – Explore ROS basic commands</h3>
<ol type="1">
<li><p>Basic commands.</p>
<ul>
<li><p>Change directory to a specific ROS package (hint use TAB key for autocompletion) (example of package name: <em>turtlebot3_gazebo</em>)</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] roscd &lt;ros_package_name&gt;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Linux basic commands.</p>
<ol type="a">
<li><p>List files in current directory</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] ls</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Change to directory</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] cd &lt;dir_name&gt;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Print current directory/path</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] pwd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Display content of a file in the terminal</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] cat &lt;filename&gt;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Open files in an editor. Use ‘code’ or ‘nano’ to view and edit files.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] code &lt;filename&gt;  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol></li>
</ul></li>
<li><p>Explore the turtlebot3 Gazebo package (Gazebo is the ROS simulator)</p>
<ul>
<li><p>Go into the <em>turtlebot3_gazebo</em> ros package</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] roscd turtlebot3_gazebo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Explore its files and subdirectories (use <em>cd</em>, <em>ls</em>, <em>cat</em> and/or your preferred file editor).</p></li>
<li><p>Now find the <em>turtlebot3_simulation.launch</em> launcher file and read its content.&nbsp; This launcher file is a good simple example of launcher. It declares a few arguments and defines the parameters for the ‘turtlebot3_drive’ controller defined in /src/turtlebot3_drive.cpp and finally starts it. Within a launcher file, it is possible to parameterize and start multiple other launchers and nodes. It is very useful within ROS to make life easier and start multiple nodes with a single command.</p></li>
</ul></li>
<li><p>Start and close roscore. Roscore is the main server orchestrating ROS. Start it by typing roscore in a terminal. Terminate it by hitting ‘ctrl-c’ in the terminal where roscore is running. (‘ctlr-c’ terminates the current running process).</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] roscore</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol>
<p>Now let’s start a simulation and explore how to viualize the available topics and their content.</p>
<ol start="4" type="1">
<li>Run a (single) node (simulation)</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/image1.png" class="img-fluid figure-img" style="width:40.0%" data-margin="auto"></p>
<figcaption>Turlesim GUI</figcaption>
</figure>
</div>
<ul>
<li><p>First install turtlesim package. Turtlesim is a basic package that is often used to introduce newcomers to ROS and robotics. You can find many examples and tutorials online.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] sudo apt install ros-noetic-turtlesim</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>In a first terminal, start roscore</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal-1] roscore</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>In a second terminal, run turtlesim node from the turtlesim package</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal-2] rosrun turtlesim turtlesim_node</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>In a third terminal, run turtle_teleop_key node from the turtlesim package. With focus on this terminal, you should now be able to move the turtle using the arrow keys on your keyboard.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal-3] rosrun turtlesim turtle_teleop_key</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Close the teleop Node. (Hit q or ctrl-c in the third terminal). Keep the two other nodes running (terminal 1 and 2).</p></li>
<li><p>List available topics.<br>
Hint: use ‘-h’ option to get some more information about a command (ie. <code>rostopic -h</code>)</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal-3] rostopic list</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>/rosout</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>/rosout_agg</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>/turtle1/cmd_vel</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>/turtle1/color_sensor</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>/turtle1/pose</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Listen to a topic and output its values.<br>
Hint: use <code>rostopic echo -n 2 /turtle1/pose</code> to output only 2 consecutive values.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal-3] rostopic echo /turtle1/pose</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>x: 5.544444561004639</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>y: 5.544444561004639</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>theta: 0.0</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>linear_velocity: 0.0</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>angular_velocity: 0.0</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>List available services</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal-3] rosservice list</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>/clear</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>/kill</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>/reset</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>/rosout/get_loggers</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>/rosout/set_logger_level</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>/spawn</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>/turtle1/set_pen</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>/turtle1/teleport_absolute</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>/turtle1/teleport_relative</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>/turtlesim/get_loggers</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>/turtlesim/set_logger_level</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Call a service. For example, using the command below will reset the turtle simulation.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal-3] rosservice call /reset</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>List existing nodes</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal-3] rosnode list</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>/rosout</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>/turtlesim</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
<ol start="5" type="1">
<li><p>Start and use visualization tools. Note: You should still have roscore and turtlesim_node running in distinct consoles.</p>
<ul>
<li><p>Start rqt_graph to visualize nodes, topics and their connections. Select Nodes/Topics (all) and uncheck all ‘hide’ options to see all available topics and nodes. You can close the window once finished.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal-3] rqt_graph</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Start rqt to interact and visualize the topics and their data. To display topics, go to Plugins-&gt;Topics-&gt;TopicMonitor. You can select and unselect topics to monitor their values. You can use the different Plugins from the menu to plot graphs (visualization-&gt;plot). You publish data to topics (Topics-&gt;EasyMessagePublisher or MessagePublisher) and many more.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal-3] rqt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Now try to move the turtle by publishing messages to the /turtle1/cmd_vel topic. Open the Plugins-&gt;Topics-&gt;MessagePublisher window, select the correct topic, use a rate of 10hz, choose values for linear (x value) and angular (z value) vectors. Enable the topic and observe your turtle move.</p></li>
</ul></li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/rqt_turtle_sim_publish.png" class="img-fluid figure-img" style="width:80.0%" data-margin="auto"></p>
<figcaption>RQT GUI. Showing the Message Publisher plugin.</figcaption>
</figure>
</div>
</section>
<section id="task-2-control-the-turtlebot3-in-the-real-world" class="level3">
<h3 class="anchored" data-anchor-id="task-2-control-the-turtlebot3-in-the-real-world">Task 2 – Control the Turtlebot3 in the real world</h3>
<p>In this task, you will set up and control the real Turtlebot3 robot. To avoid ambiguity, in our command instructions, we use [localpc-terminal] and [turtelbot-terminal] to indicate whether we are referring to the terminal of your own machine or the terminal of the turtlebot (usually over sh).</p>
<ol start="0" type="1">
<li><p>Disable your firewalls (Windows or WSL) On Windows, you must disable your firewalls, otherwise ROS messages are blocked. Go to your OS settings and disable firewalls for networks (at least for the ProFab network).</p></li>
<li><p>Connect to profab_wifi (ssid: ProFab, password: 1700_UniFR.&amp;)</p></li>
<li><p>Note down your <code>local_machine_ip</code>. You can find your IP address by running the command below in your terminal. Look for the <code>inet</code> address under your active network interface (e.g., <code>eth0</code> or <code>wlan0</code>). This is your local machine’s IP address. Note that this IP may change every time you reconnect to the network.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] ifconfig</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>        inet 192.168.1.2  netmask 255.255.255.0  broadcast 192.168.1.255</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>        inet6 fe80::ce0f:9b9a:fd5e:691  prefixlen 64  scopeid 0x20&lt;link&gt;</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>        ether 74:da:38:02:6b:25  txqueuelen 1000  (Ethernet)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>        RX packets 4113  bytes 492050 (492.0 KB)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>        RX errors 0  dropped 0  overruns 0  frame 0</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>        TX packets 3569  bytes 339521 (339.5 KB)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>        inet 127.0.0.1  netmask 255.0.0.0</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>        loop  txqueuelen 1000  (Local Loopback)</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>        RX packets 466207  bytes 163272745 (163.2 MB)</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>        RX errors 0  dropped 0  overruns 0  frame 0</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>        TX packets 466207  bytes 163272745 (163.2 MB)</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>loopback0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>        ether 00:15:5d:06:93:a0  txqueuelen 1000  (Ethernet)</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>        RX packets 14197575  bytes 1588446856 (1.5 GB)</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>        RX errors 0  dropped 0  overruns 0  frame 0</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>        TX packets 14197154  bytes 1588361451 (1.5 GB)</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Update your bashrc and add the lines shown below at the end of the file.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] code ~/.bashrc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Here are the lines I added to my bashrc file</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a># Get your public IP address </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>alias myip='curl ifconfig.me; echo'</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>#Added for ROS integration within terminals</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>source ~/profab_ws/devel/setup.bash </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>source /opt/ros/noetic/setup.bash</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>## Added to enable graphical library use for ROS. This is needed for the turtlebot3 simulation to work properly and to avoid errors related to OpenGL when running rviz or Gazebo. </span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>export LIBGL_ALWAYS_SOFTWARE=1</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>#Added by for BURGER TurtleBot </span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>export TURTLEBOT3_MODEL=burger</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a># Settings to use the real robot (use your own &lt;local_machine_ip&gt;) </span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>export ROS_MASTER_URI=http://192.168.1.2:11311</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>export ROS_HOSTNAME=192.168.1.2</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a># Settings to use the turtlebot3 in simulation (uncomment the two lines below) </span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>#export ROS_MASTER_URI=http://127.0.0.1:11311 </span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>#export ROS_HOSTNAME=127.0.0.1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Source your new bashrc to apply the changes. Source it on all open terminals.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] source ~/.bashrc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Turn on the robot. It is already configured to connect automatically to ProFab wifi. If you want to use it on a different wifi, you need to modify some files on the robot (see Task 5 for detailed instructions).</p></li>
<li><p>Ssh into the robot (the IP must be the one of your turtlebot3). Each robot should have a label indicating its IP when using the ProFab wifi.<br>
Note: Turtlebot3 OS - user: ubuntu, password: turtlebot. We will now refer to this ssh terminal by using [turtlebot-terminal] before indicating commands.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] ssh ubuntu@192.168.1.101</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Update the robot bashrc (edit the file using nano editor). Update ROS_MASTER_URI variable in the .bashrc file with the value of your <em>localpc-ip</em>. Save, exit nano and then source your file.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>[turtlebot-terminal] nano ~/.bashrc         </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>[turtlebot-terminal] source ~/.bashrc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Start roscore on your local machine (open a new terminal if necessary)</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal-1] roscore</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Start turtlebot3_robot node on the robot. This establishes the connection between the robot and ROS and brings up all necessary drivers.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>[turtlebot-terminal] roslaunch turtlebot3_bringup turtlebot3_robot.launch</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Start teleop on your local machine (open a new terminal if necessary)</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal-2] roslaunch turtlebot3_teleop turtlebot3_teleop_key.launch</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol>
<p>Now you should be able to move the robot using ‘awsdx’ keys on your keyboard (the focus must be on the terminal running teleop).</p>
<ol start="11" type="1">
<li>When you are done playing with the robot, terminate all processes on the localpc (keep the real robot running with its node on)</li>
</ol>
<p>Now let’s visualize the sensors of the robot on rviz in real-time</p>
<ol start="12" type="1">
<li><p>Start the node of your robot and roscore on your localpc. This automatically starts rviz and allows you to visualize the robot and its sensors (Remember: the roslauch command does automatically starts roscore, if it is not already running)</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal-1] roslaunch turtlebot3_bringup turtlebot3_model.launch    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><u>Hints:</u></p>
<ul>
<li><p>If you do not see Lidar readings (the red dots on the image below), do the following changes. In your terminal, type the command below before typing the roslaunch command. You may also want to add this command in your ‘~/.bashrc’ file to avoid retyping it every time you launch a new terminal.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>$ export LIBGL_ALWAYS_SOFTWARE=1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/rviz_laserscan.png" class="img-fluid figure-img" style="width:80.0%" data-margin="auto"></p>
<figcaption>Rviz interface displaying the robot and the lidar data. The Lidar scan data are represented with the red dots.</figcaption>
</figure>
</div></li>
</ol>
</section>
<section id="task-3-control-the-turtlebot3-in-simulation" class="level3">
<h3 class="anchored" data-anchor-id="task-3-control-the-turtlebot3-in-simulation">Task 3 – Control the Turtlebot3 in simulation</h3>
<ol type="1">
<li><p>Update your bashrc (modify settings to set your ips back to simulation). Comment the two lines for the real robot and uncomment the ones for simulaton.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] code ~/.bashrc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Start roscore and the gazebo simulation for the turtlebot3</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal1] roslaunch turtlebot3_gazebo turtlebot3_world.launch</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Start teleop node and move the robot (using awsdx keys)</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal1] roslaunch turtlebot3_teleop turtlebot3_teleop_key.launch</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Stop teleop (Hit ctrl-c in the terminal)</p></li>
<li><p>Start rqt and send Twist commands to the right topic to make the robot move</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal1] rqt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol>
</section>
<section id="task-4---create-a-controller-for-the-turtlebot3" class="level3">
<h3 class="anchored" data-anchor-id="task-4---create-a-controller-for-the-turtlebot3">Task 4 - Create a controller for the Turtlebot3</h3>
<p>In this task, you will create your first package and then develop the code for a simple collision avoidance controller for the Turtelbot3. You will test it in the simulated environment. Finally, you will create a launch file to start your controller and the simulated world. Note: the developed controller will be tested in simulation but it could also be used to control the real turtlebot3 without any modification.</p>
<section id="create-a-package" class="level4">
<h4 class="anchored" data-anchor-id="create-a-package">Create a package</h4>
<ol type="1">
<li><p>Change directory to the src directory of your workspace:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] cd ~/profab_ws/src</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Create the new package using the <em>catkin_create_pkg</em> command. The command below creates a new package named <em>turtlebot3_profab</em>, which depends on std_messages, turtlebot3_msgs, sensor_msgs, geometry_msgs and rospy. This will create a <em>turtlebot3_profab</em> folder which contains the <em>package.xml</em> and the <em>CMakeLists.txt</em> files, which have been partially filled out with the information you gave to the command <em>catkin_create_pkg</em>.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] catkin_create_pkg turtlebot3_profab std_msgs turtlebot3_msgs sensor_msgs geometry_msgs rospy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Note</strong>: if you need to add external dependencies such as msgs and/or packages afterward, you need to modify these two files and rebuild the package with ‘catkin_make’.</p></li>
<li><p>Now you must build packages in your workspace (which will also build your package). Go back to the root of your workspace and (re)build it</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] cd ~/profab_ws/</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb38"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] catkin_make</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Note</strong>: after the workspace has been built, it has created a standardized structure in the devel subfolder. You may want to have a quick look at it.</p></li>
</ol>
</section>
<section id="create-and-run-your-first-controller-node" class="level4">
<h4 class="anchored" data-anchor-id="create-and-run-your-first-controller-node">Create and run your first controller node</h4>
<p>Now let’s start creating our first controller node.</p>
<p>Start a terminal and type the following commands:</p>
<ol start="4" type="1">
<li><p>Change directory to your newly created package</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] cd ~/profab_ws/src/turtlebot3_profab</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Create a new ‘scripts’ folder and change directory</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] mkdir scripts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb41"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] cd scripts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Create a new file for your ‘controller’ node with the ‘touch’ command and make it executable with the chmod command<br>
<strong>Info</strong>: If want to know more about a command, you can always use its –help option (see below).</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] touch --help</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb43"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] touch ca_controller.py</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb44"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] chmod +x ca_controller.py</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Start coding with your favorite IDE (using Visual Studio Code here)</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] code ca_controller.py</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Use the partial source code below for your script (you can copy-paste) First have a look at the code to understand its structure. It is a typical structure for the code of a node.</p>
<ul>
<li>Look at the run() function. When does the controller stops ?</li>
<li>Look at the initialisation of the two different topics (publisher, subscriber). What do their parameters correspond to ?</li>
<li>Look and understand the scan_callback() function. What is the current moving logic ? What will be the behaviour of the robot ?</li>
<li>Look at the clean shutdown logic. What should you do here to prevent problems ?</li>
<li>Test compiling and running the script (see step 9, 10 and 11 below) before modifying it.</li>
</ul></li>
<li><p>Modify you CMakeLists.txt file. it is located in the ‘root’ folder of your package (i.e.&nbsp;~/profab_ws/src/turtlebot3_profab/). This makes sure the Python script gets installed properly and uses the right Python interpreter. Add the line in the INSTALL directive (~line 170) of the file.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>catkin_install_python(PROGRAMS scripts/ca_controller.py DESTINATION ${CATKIN_PACKAGE_BIN_DESTINATION})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Go back to the root directory of your workspace and (re)build it</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] cd ~/profab_ws/</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb48"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] catkin_make</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Now start your node<br>
<strong>Hint</strong>: Use three distinct terminals: start ‘roscore’ in one terminal, your turtlebot3 simulation in the second terminal and your ‘ca_controller.py’ node in the third terminal.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] roscore</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb50"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] roslaunch turtlebot3_gazebo turtlebot3_world.launch</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb51"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] rosrun turtlebot3_profab ca_controller.py</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Terminate ‘roscore’, ‘turtlebot3_world’ and ‘ca_controller’ nodes using “ctrl-c” from their respective terminal. (Note: terminating ‘roscore’ should automatically terminate the ‘ca_controller’ node, see L10 in code above)</p></li>
</ol>
</section>
<section id="modify-the-controller-to-include-a-collision-avoidance-logic" class="level4">
<h4 class="anchored" data-anchor-id="modify-the-controller-to-include-a-collision-avoidance-logic">Modify the controller to include a collision avoidance logic</h4>
<ol start="14" type="1">
<li><p>Now reopen the ‘ca_controller.py’ script and modify according to the provided comments so that the robot moves forward and avoid obstacles. Most of the necessary changes that must be made are located in the scan_callback() function (see all TODOs). The expected new behaviour is to avoid obstacles in front of the robot to avoid collisions. One possible solution is the following: if front_scans are below a defined threshold, rotate left or right (depending on left or right scans). Otherwise, move straight. Of course, you may code a more complex logic; do not hesitate to play with this controller once you have a first working solution.</p></li>
<li><p>Now you can start your nodes to test your implemented logic<br>
<strong>Hint</strong>: Use three distinct terminals: start ‘roscore’ in one terminal, your turtlebot3 simulation in the second terminal and your ‘ca_controller’ node in the third terminal.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] roscore</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb53"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] roslaunch turtlebot3_gazebo turtlebot3_world.launch</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb54"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] rosrun turtlebot3_profab ca_controller.py</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/usr/bin/env python3</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rospy</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> geometry_msgs.msg <span class="im">import</span> Twist</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sensor_msgs.msg <span class="im">import</span> LaserScan</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="co">##</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a><span class="co">## Exercise</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a><span class="co">## You need to fill the </span><span class="al">TODO</span><span class="co"> parts to implement your logic</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a><span class="co">##</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a><span class="co">## LIDAR INFORMATION </span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Contrary to simulation, real robot does not receive exactly 360 measures every scan (more or less around 270). Therefore it is necessary to know where it started its scan, the angle between two measures (provided by the robot /scan topic). We can use this information to convert that to 0 - 360 information in order to facilitate processing. The lambda function below helps doing that. In the end, the user receives two arrays of same lengths. The first array contains the angles and the second array contains the distances. (0 degree is ahead, 90 is left, 180 is behind and 270 is right)</span></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a><span class="co"># More information on how to process lidar data https://stanbaek.github.io/ece387/Module8_LIDAR/LIDAR.html</span></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a><span class="co"># lambda function to convert rad to deg</span></span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>RAD2DEG <span class="op">=</span> <span class="kw">lambda</span> x: ((x)<span class="op">*</span><span class="fl">180.</span><span class="op">/</span>math.pi)</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CollisionAvoidance:</span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>        rospy.init_node(<span class="st">'collision_avoidance_controller'</span>, anonymous<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>        rospy.loginfo(<span class="st">"Collision avoidance controller has started"</span>)</span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Do some cleanup on shutdown</span></span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>        rospy.on_shutdown(<span class="va">self</span>.clean_shutdown)</span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Publisher to send velocity commands</span></span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cmd_vel_pub <span class="op">=</span> rospy.Publisher(<span class="st">'/cmd_vel'</span>, Twist, queue_size<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Subscriber to get LIDAR scans</span></span>
<span id="cb55-33"><a href="#cb55-33" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.scan_sub <span class="op">=</span> rospy.Subscriber(<span class="st">'/scan'</span>, LaserScan, <span class="va">self</span>.scan_callback)</span>
<span id="cb55-34"><a href="#cb55-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-35"><a href="#cb55-35" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span><span class="al">TODO</span><span class="co"> - Define a safety threshold in meters (Minimum distance to consider an obstacle (in meters))</span></span>
<span id="cb55-36"><a href="#cb55-36" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.min_dist <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb55-37"><a href="#cb55-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-38"><a href="#cb55-38" aria-hidden="true" tabindex="-1"></a>        rospy.loginfo(<span class="st">"Collision avoidance controller initialized with min_dist = </span><span class="sc">%f</span><span class="st">"</span>, <span class="va">self</span>.min_dist)</span>
<span id="cb55-39"><a href="#cb55-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-40"><a href="#cb55-40" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Initialize Twist message for movement commands    </span></span>
<span id="cb55-41"><a href="#cb55-41" aria-hidden="true" tabindex="-1"></a>        <span class="co"># This message will be used to control the robot's linear and angular velocities</span></span>
<span id="cb55-42"><a href="#cb55-42" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.twist <span class="op">=</span> Twist()</span>
<span id="cb55-43"><a href="#cb55-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-44"><a href="#cb55-44" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Main loop rate</span></span>
<span id="cb55-45"><a href="#cb55-45" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.rate <span class="op">=</span> rospy.Rate(<span class="dv">10</span>)  <span class="co"># 10 Hz</span></span>
<span id="cb55-46"><a href="#cb55-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-47"><a href="#cb55-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-48"><a href="#cb55-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-49"><a href="#cb55-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-50"><a href="#cb55-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Callback function to process LIDAR scan data</span></span>
<span id="cb55-51"><a href="#cb55-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># This function will be called whenever a new scan message is received</span></span>
<span id="cb55-52"><a href="#cb55-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># It processes the scan data to determine if there are obstacles in the way</span></span>
<span id="cb55-53"><a href="#cb55-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># and sets the appropriate movement commands for the robot</span></span>
<span id="cb55-54"><a href="#cb55-54" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> scan_callback(<span class="va">self</span>, scan_data):</span>
<span id="cb55-55"><a href="#cb55-55" aria-hidden="true" tabindex="-1"></a>        degrees <span class="op">=</span> []</span>
<span id="cb55-56"><a href="#cb55-56" aria-hidden="true" tabindex="-1"></a>        ranges <span class="op">=</span> []</span>
<span id="cb55-57"><a href="#cb55-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-58"><a href="#cb55-58" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Arrays with detected distances for each considered directions</span></span>
<span id="cb55-59"><a href="#cb55-59" aria-hidden="true" tabindex="-1"></a>        front <span class="op">=</span> []</span>
<span id="cb55-60"><a href="#cb55-60" aria-hidden="true" tabindex="-1"></a>        left <span class="op">=</span> []</span>
<span id="cb55-61"><a href="#cb55-61" aria-hidden="true" tabindex="-1"></a>        right <span class="op">=</span> []</span>
<span id="cb55-62"><a href="#cb55-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-63"><a href="#cb55-63" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Determine how many scans were taken during rotation</span></span>
<span id="cb55-64"><a href="#cb55-64" aria-hidden="true" tabindex="-1"></a>        count <span class="op">=</span> <span class="bu">len</span>(scan_data.ranges)</span>
<span id="cb55-65"><a href="#cb55-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-66"><a href="#cb55-66" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(count):</span>
<span id="cb55-67"><a href="#cb55-67" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Using scan_data.angle_min and scan_data.angle_increment data to determine current angle, </span></span>
<span id="cb55-68"><a href="#cb55-68" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Also convert radian to degrees (0 degree is ahead, 90 is left, 180 is behind and 270 is right)</span></span>
<span id="cb55-69"><a href="#cb55-69" aria-hidden="true" tabindex="-1"></a>            degrees.append(<span class="bu">int</span>(RAD2DEG(scan_data.angle_min <span class="op">+</span> scan_data.angle_increment<span class="op">*</span>i)))</span>
<span id="cb55-70"><a href="#cb55-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-71"><a href="#cb55-71" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Append the distance detected to the array of distances</span></span>
<span id="cb55-72"><a href="#cb55-72" aria-hidden="true" tabindex="-1"></a>            rng <span class="op">=</span> scan_data.ranges[i]</span>
<span id="cb55-73"><a href="#cb55-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-74"><a href="#cb55-74" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Ensure range values are valid; set to 0 if not</span></span>
<span id="cb55-75"><a href="#cb55-75" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> rng <span class="op">&lt;</span> scan_data.range_min <span class="kw">or</span> rng <span class="op">&gt;</span> scan_data.range_max:</span>
<span id="cb55-76"><a href="#cb55-76" aria-hidden="true" tabindex="-1"></a>                ranges.append(<span class="fl">0.0</span>)</span>
<span id="cb55-77"><a href="#cb55-77" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb55-78"><a href="#cb55-78" aria-hidden="true" tabindex="-1"></a>                ranges.append(rng)</span>
<span id="cb55-79"><a href="#cb55-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-80"><a href="#cb55-80" aria-hidden="true" tabindex="-1"></a>        <span class="co"># python way to iterate two lists at once!</span></span>
<span id="cb55-81"><a href="#cb55-81" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> deg, rng <span class="kw">in</span> <span class="bu">zip</span>(degrees, ranges):</span>
<span id="cb55-82"><a href="#cb55-82" aria-hidden="true" tabindex="-1"></a>            <span class="co">#rospy.loginfo("Processing zipped scan_data - degree: %d, range: %f", deg, rng)</span></span>
<span id="cb55-83"><a href="#cb55-83" aria-hidden="true" tabindex="-1"></a>            <span class="co"># if the range is not 0, append to the appropriate list</span></span>
<span id="cb55-84"><a href="#cb55-84" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> rng <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb55-85"><a href="#cb55-85" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (deg <span class="op">&gt;=</span> <span class="dv">340</span> <span class="kw">or</span> deg <span class="op">&lt;=</span> <span class="dv">20</span>): </span>
<span id="cb55-86"><a href="#cb55-86" aria-hidden="true" tabindex="-1"></a>                    front.append(rng)</span>
<span id="cb55-87"><a href="#cb55-87" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> <span class="dv">30</span> <span class="op">&lt;=</span> deg <span class="op">&lt;=</span> <span class="dv">60</span>:</span>
<span id="cb55-88"><a href="#cb55-88" aria-hidden="true" tabindex="-1"></a>                    left.append(rng)</span>
<span id="cb55-89"><a href="#cb55-89" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> <span class="dv">300</span> <span class="op">&lt;=</span> deg <span class="op">&lt;=</span> <span class="dv">330</span>:</span>
<span id="cb55-90"><a href="#cb55-90" aria-hidden="true" tabindex="-1"></a>                    right.append(rng)</span>
<span id="cb55-91"><a href="#cb55-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-92"><a href="#cb55-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-93"><a href="#cb55-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-94"><a href="#cb55-94" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span><span class="al">TODO</span><span class="co"> - Find minimum distances for each considered direction</span></span>
<span id="cb55-95"><a href="#cb55-95" aria-hidden="true" tabindex="-1"></a>        min_front_dist <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb55-96"><a href="#cb55-96" aria-hidden="true" tabindex="-1"></a>        min_left_dist <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb55-97"><a href="#cb55-97" aria-hidden="true" tabindex="-1"></a>        min_right_dist <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb55-98"><a href="#cb55-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-99"><a href="#cb55-99" aria-hidden="true" tabindex="-1"></a>        rospy.loginfo(<span class="st">"Front distance: </span><span class="sc">%f</span><span class="st">, Left distance: </span><span class="sc">%f</span><span class="st">, Right distance: </span><span class="sc">%f</span><span class="st">"</span>, min_front_dist, min_left_dist, min_right_dist)</span>
<span id="cb55-100"><a href="#cb55-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-101"><a href="#cb55-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-102"><a href="#cb55-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-103"><a href="#cb55-103" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span><span class="al">TODO</span><span class="co"> - Create the decision logic for the motion. Currently it just moves forward.</span></span>
<span id="cb55-104"><a href="#cb55-104" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span><span class="al">TODO</span><span class="co"> - Recommendation: choose to rotate left or right if something is detected ahead, below the defined safety_threshold, otherwise move straight forward. </span></span>
<span id="cb55-105"><a href="#cb55-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-106"><a href="#cb55-106" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Move forward </span></span>
<span id="cb55-107"><a href="#cb55-107" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.twist.linear.x <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb55-108"><a href="#cb55-108" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.twist.angular.z <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb55-109"><a href="#cb55-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-110"><a href="#cb55-110" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Send motion commands to motors</span></span>
<span id="cb55-111"><a href="#cb55-111" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cmd_vel_pub.publish(<span class="va">self</span>.twist)</span>
<span id="cb55-112"><a href="#cb55-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-113"><a href="#cb55-113" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> run(<span class="va">self</span>):</span>
<span id="cb55-114"><a href="#cb55-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-115"><a href="#cb55-115" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="kw">not</span> rospy.is_shutdown():</span>
<span id="cb55-116"><a href="#cb55-116" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Spin to keep the node running and process callbacks</span></span>
<span id="cb55-117"><a href="#cb55-117" aria-hidden="true" tabindex="-1"></a>            rospy.spin()</span>
<span id="cb55-118"><a href="#cb55-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-119"><a href="#cb55-119" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> clean_shutdown(<span class="va">self</span>):</span>
<span id="cb55-120"><a href="#cb55-120" aria-hidden="true" tabindex="-1"></a>        rospy.loginfo(<span class="st">"Collision avoidance controller is shutting down."</span>)</span>
<span id="cb55-121"><a href="#cb55-121" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span><span class="al">TODO</span><span class="co"> - Stop the robot if the node is shut down (for safety)</span></span>
<span id="cb55-122"><a href="#cb55-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-123"><a href="#cb55-123" aria-hidden="true" tabindex="-1"></a>        rospy.loginfo(<span class="st">"Robot stopped."</span>)</span>
<span id="cb55-124"><a href="#cb55-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-125"><a href="#cb55-125" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb55-126"><a href="#cb55-126" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb55-127"><a href="#cb55-127" aria-hidden="true" tabindex="-1"></a>        controller <span class="op">=</span> CollisionAvoidance()</span>
<span id="cb55-128"><a href="#cb55-128" aria-hidden="true" tabindex="-1"></a>        controller.run()</span>
<span id="cb55-129"><a href="#cb55-129" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> rospy.ROSInterruptException:</span>
<span id="cb55-130"><a href="#cb55-130" aria-hidden="true" tabindex="-1"></a>        <span class="cf">pass</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol>
<p>Some more details about portions of the code above:</p>
<ul>
<li><p>Shebang (line 1, <code>#!/usr/bin/env python3</code>): every Python ROS&nbsp;node&nbsp;will have this declaration at the top. This first line makes sure your script is executed as a Python script.</p></li>
<li><p>Imports (lines 2-5): imports the necessary packages</p></li>
<li><p>Main CollisionAvoidance class :</p>
<ul>
<li><p>def init(self): define potential variables, initialize ros node and connect to topics (pub and sub).</p>
<p>The line <code>rospy.init_node</code> is very important as it tells ‘rospy’ the name of your node; until rospy has this information, it cannot start communicating with the ROS Master. NOTE: the name must be a base name, i.e.&nbsp;it cannot contain any slashes “/” or other special characters.</p>
<p>The line <code>self.rate = rospy.Rate(10)</code> defines the main loop rate: this sets how often the loop will run, in this case, 10 times per second. It allows the controller to process incoming scan data and publish movement commands at a regular interval. With its argument is 10, we should expect to go through the loop 10 times per second (as long as our processing time does not exceed 1/10th of a second!)</p>
<p>Note the subscription to the LIDAR scan topic that triggers a callback function. The callback function is called upon reception of a message on the topic. Its goal is then to handle the received data as you can see in the content of the <code>def scan_callback(self, scan_data)</code> defined function below.</p></li>
<li><p>def run(self): keeps the routine running while rospy is not shutdown (basically waiting for ctrl-c).</p></li>
<li><p>def clean_shutdown(self): this function is called upon shut down (i.e.&nbsp;when the user hits ctrl-c or closes the console) and ensures a clean/safe shutdown, for example by sending commands to stop the motors of the robot.</p></li>
</ul></li>
</ul>
</section>
<section id="create-a-launcher" class="level4">
<h4 class="anchored" data-anchor-id="create-a-launcher">Create a launcher</h4>
<p>Starting multiple nodes in distinct terminals can be quite painful and boring. The goal of a launch script is to automate the launching of multiple nodes using a single command. You can find additional information about launch files using this <a href="http://wiki.ros.org/roslaunch/XML">link</a>.</p>
<p>In a terminal and type the following commands:</p>
<ol start="16" type="1">
<li><p>Change directory to the root of your package scripts directory of your package, create a ‘launch’ directory and a new ‘launch’ file in this new directory,</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] cd ~/protofab_ws/src/turtlebot3_profab/</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] mkdir launch</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] cd launch</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] touch sim_collavoid.launch</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Edit the launch file to include start the gazebo simulation launcher and your node Note the ‘output=”screen”’ option that is needed in order to allow your node to output text on the console.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>&lt;launch&gt;</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>    &lt;include file="$(find turtlebot3_gazebo)/launch/turtlebot3_world.launch"/&gt;</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    &lt;node name="controller" pkg="turtlebot3_profab" type="ca_controller.py" output="screen"/&gt;</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>&lt;/launch&gt;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Change directory to the root of your workspace and (re)build it:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] cd ~/protofab_ws/         </span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] catkin_make</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Now you can start all your nodes and roscore using one single command Note that when you use a launcher, roscore is automatically started ! You do not need to specify it in the launcher file!</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] roslaunch turtlebot3_profab sim_collavoid.launch</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol>
<p>Congratulations, you have now created your first nodes and made them exchange messages! You can now continue to the next task!</p>
</section>
<section id="optional-test-your-controller-with-the-real-robot" class="level4">
<h4 class="anchored" data-anchor-id="optional-test-your-controller-with-the-real-robot">[Optional] Test your controller with the real robot</h4>
<ol start="20" type="1">
<li>Modify your local bashrc (update IPs)</li>
<li>Start roscore on your local pc</li>
<li>SSH onto the robot and start its node</li>
<li>Start your controller (using rosrun, not the launcher) on your local pc</li>
</ol>
<p>Your Turtlebot3 should now move and avoid obstacle, behaving similarly to the simulation. This is one the the beauty of ROS, allowing to switch from simulation to real robot easily. You may however observe that in a real environment, the developed controller is probably a bit too simple and does not allow to avoid all types of obstacles. Much more work would be needed to allow the robot to navigate in real complex environments.</p>
<!-- 
```python         
##
## CODE SOLUTION (Works with REAL robot & simulation - DO NOT GIVE TO STUDENTS)
##

#!/usr/bin/env python3
import rospy
from geometry_msgs.msg import Twist
from sensor_msgs.msg import LaserScan
import math


## LIDAR INFORMATION 
# Contrary to simulation, real robot does not receive exactly 360 measures every scan (more or less around 270). Therefore it is necessary to know where it started its scan, the angle between two measures (provided by the robot /scan topic). We can use this information to convert that to 0 - 360 information in order to facilitate processing. The lambda function below helps doing that. In the end, the user receives two arrays of same lengths. The first array contains the angles and the second array contains the distances. (0 degree is ahead, 90 is left, 180 is behind and 270 is right)
# More information on how to process lidar data https://stanbaek.github.io/ece387/Module8_LIDAR/LIDAR.html


# lambda function to convert rad to deg
RAD2DEG = lambda x: ((x)*180./math.pi)


class CollisionAvoidance:
    def __init__(self):
        rospy.init_node('collision_avoidance_controller', anonymous=True)
        rospy.loginfo("Collision avoidance controller has started")

        # Do some cleanup on shutdown
        rospy.on_shutdown(self.clean_shutdown)

        # Publisher to send velocity commands
        self.cmd_vel_pub = rospy.Publisher('/cmd_vel', Twist, queue_size=10)

        # Subscriber to get LIDAR scans
        self.scan_sub = rospy.Subscriber('/scan', LaserScan, self.scan_callback)
                
        # Safety threshold in meters
        self.min_dist = 0.5 # Minimum distance to consider an obstacle (in meters)
        rospy.loginfo("Collision avoidance controller initialized with min_dist = %f", self.min_dist)

        # Initialize Twist message for movement commands    
        # This message will be used to control the robot's linear and angular velocities
        self.twist = Twist()

        # Main loop rate
        self.rate = rospy.Rate(10)  # 10 Hz




    # Callback function to process LIDAR scan data
    # This function will be called whenever a new scan message is received
    # It processes the scan data to determine if there are obstacles in the way
    # and sets the appropriate movement commands for the robot
    def scan_callback(self, scan_data):
        degrees = []
        ranges = []
        
        front = []
        left = []
        right = []

        # determine how many scans were taken during rotation
        count = len(scan_data.ranges)

        for i in range(count):
                # Using scan_data.angle_min and scan_data.angle_increment data to determine current angle, 
                # Also convert radian to degrees (0 degree is ahead, 90 is left, 180 is behind and 270 is right)
                degrees.append(int(RAD2DEG(scan_data.angle_min + scan_data.angle_increment*i)))

                # Append the distance detected to the array of distances
                rng = scan_data.ranges[i]
                
                # Ensure range values are valid; set to 0 if not
                if rng < scan_data.range_min or rng > scan_data.range_max:
                    ranges.append(0.0)
                else:
                    ranges.append(rng)

            # python way to iterate two lists at once!
            for deg, rng in zip(degrees, ranges):
                #rospy.loginfo("Processing zipped scan_data - degree: %d, range: %f", deg, rng)
                # if the range is not 0, append to the appropriate list
                if rng > 0:
                    if (deg >= 340 or deg <= 20): 
                        front.append(rng)
                    elif 30 <= deg <= 60:
                        left.append(rng)
                    elif 300 <= deg <= 330:
                        right.append(rng)
                    

        # Average distances
        front_dist = min(front) if front else float('inf')
        left_dist = min(left) if left else float('inf')
        right_dist = min(right) if right else float('inf')
        

        rospy.loginfo("Front distance: %f, Left distance: %f, Right distance: %f", front_dist, left_dist, right_dist)

    
        # Decision logic (set movement commands based on distances)
        if front_dist < self.min_dist:
            # Obstacle ahead, turn (right or left depending on side with more space)
            self.twist.linear.x = 0.0
            self.twist.angular.z = 0.5 if left_dist > right_dist else -0.5
        else:
            # Clear path, move forward
            self.twist.linear.x = 0.1
            self.twist.angular.z = 0.0

        self.cmd_vel_pub.publish(self.twist)

    def run(self):
            
        while not rospy.is_shutdown():
            # Spin to keep the node running and process callbacks
            rospy.spin()

    def clean_shutdown(self):
        rospy.loginfo("Collision avoidance controller is shutting down.")
        # Stop the robot if the node is shut down
        stopTwist = Twist()
        self.cmd_vel_pub.publish(stopTwist)
        rospy.loginfo("Robot stopped.")

if __name__ == '__main__':
    try:
        controller = CollisionAvoidance()
        controller.run()
    except rospy.ROSInterruptException:
        pass

```
-->
</section>
</section>
<section id="optional-task-5-modify-wifi-settings-of-turtlebot3" class="level3">
<h3 class="anchored" data-anchor-id="optional-task-5-modify-wifi-settings-of-turtlebot3">[OPTIONAL] Task 5 – Modify WIFI settings of Turtlebot3</h3>
<p>In order to modify the wifi settings of your Turtlebot3, you need to connect it directly to a monitor and a keyboard (Note: you can also do it in ssh IF you have remote access capabilities). Then you can modify the network configuration file to change the wifi settings of the robot. You need to modify the file <code>/etc/netplan/cloud-init.yaml</code>: change ProFab to your own wifi name (ssid) and 1700_UniFR.&amp; to your own password. Save the file and reboot the robot. The robot should now connect to your own wifi automatically. Unfortunately, it seems not possible to define multiple networks … the file must be adapted every network change.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>[turtlebot-terminal] sudo nano /etc/netplan/cloud-init.yaml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb61"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a># This file is generated from information provided by the datasource. Changes</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a># to it will not persist across an instance reboot. To disable cloud-init's</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a># network configuration capabilities, write a file</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a># /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a># network: {config: disabled} </span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>network:</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>  version: 2</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>  renderer: networkd</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>  ethernets:</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>    eth0:</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>      dhcp4: yes</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>      dhcp6: yes</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>      optional: true</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>  wifis:</span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>    wlan0:</span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>      dhcp4: yes</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>      dhcp6: yes</span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>      access-points:</span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>        ProFab:</span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>          password: 1700_UniFR.&amp;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="optional-task-6-connect-a-usb-webcam" class="level3">
<h3 class="anchored" data-anchor-id="optional-task-6-connect-a-usb-webcam">[OPTIONAL] Task 6 – Connect a USB webcam</h3>
<p>In our test, we used a Logi C270 HD webcam (Logitec); but the tutorial should work for most usb cameras.</p>
<p>To setup a usb camera on the robot, there are two possible packages that can be used:</p>
<ol type="1">
<li><p><strong>usb-cam package</strong>: simple and more configurable, for more details, see <a href="http://wiki.ros.org/usb_cam">link1</a>, <a href="https://github.com/yev-d/tutos/blob/master/ROS/Tutorial-001/Remotely-connecting-to-webcam-using-Raspberry-Pi-3-and-ROS.md">link2</a> or this <a href="https://www.youtube.com/watch?v=StHfHCPrHOw">video</a></p></li>
<li><p><strong>cv_camera package</strong>: relies on openCV to transmit data (seemed less configurable), for more details, see this <a href="https://www.theconstruct.ai/how-to-install-a-usb-camera-in-turtlebot3/">link</a></p></li>
</ol>
<p>In this guide, we will provide instructions for method 1 (usb-cam package).</p>
<ol type="1">
<li>Update your sources and install packages (may take a some time …)</li>
</ol>
<div class="sourceCode" id="cb62"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>[turtlebot-terminal] sudo apt update      </span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>[turtlebot-terminal] sudo apt install -y libv4l-dev    </span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>[turtlebot-terminal] sudo apt install -y ros-noetic-image-transport  (to enable compressing images for transport over wifi)     </span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>[turtlebot-terminal] sudo apt install -y ros-noetic-camera-info-manager     </span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>[turtlebot-terminal] sudo apt install -y ros-noetic-usb-cam</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="2" type="1">
<li>Use the commands below to launch the camera node (you can nano the usb_cam-test.launch file to see its settings). When using image_view on your local pc, you should be able to see the image. If the procedure below works; this means that your camera is now functional.</li>
</ol>
<div class="sourceCode" id="cb63"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>[turtlebot-terminal] roslaunch /opt/ros/noetic/share/usb_cam/launch/usb_cam-test.launch</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>[localpc-terminal-1] roscore</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>[localpc-terminal-2] rosrun image_view image_view image:=/usb_cam/image_raw</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="3" type="1">
<li><p>To integrate it to the Turtlebot, you need to make it start automatically with the robot. You must first copy the launcher for the usbcam to your own workspace. Then copy the robot launcher file (<code>turtlebot3_robot.launch</code>) that you will then adapt to include your new usbcam.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>[turtlebot-terminal] roscd turtlebot3_bringup</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>[turtlebot-terminal] cd launch    </span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>[turtlebot-terminal] cp /opt/ros/noetic/share/usb_cam/launch/usb_cam-test.launch turtlebot3_usbcam.launch</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>[turtlebot-terminal] cp turtlebot3_robot.launch turtlebot3_robot_usbcam.launch</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Now edit your new launch file. Add the directive to also start your usbcam. An example of such launch file is provided below.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>[turtlebot-terminal] nano turtlebot3_robot_usbcam.launch</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb66"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>&lt;launch&gt; </span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>    &lt;arg name="multi_robot_name" default=""/&gt; </span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>    &lt;arg name="set_lidar_frame_id" default="base_scan"/&gt; </span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>    &lt;arg name="model" default="$(env TURTLEBOT3_MODEL)" doc="model type [burger, waffle, waffle_pi]"/&gt;</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>    &lt;include file="$(find turtlebot3_bringup)/launch/turtlebot3_core.launch"&gt;</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>        &lt;arg name="multi_robot_name" value="$(arg multi_robot_name)"/&gt;</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>    &lt;/include&gt;</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>    &lt;include file="$(find turtlebot3_bringup)/launch/turtlebot3_lidar.launch"&gt;</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>        &lt;arg name="set_frame_id" value="$(arg set_lidar_frame_id)"/&gt;</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>    &lt;/include&gt;</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>    &lt;include file="$(find turtlebot3_bringup)/launch/turtlebot3_usbcam.launch"/&gt;</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>    &lt;node pkg="turtlebot3_bringup" type="turtlebot3_diagnostics" name="turtlebot3_diagnostics" output="screen"/&gt;</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>    &lt;group if = "$(eval model == 'waffle_pi')"&gt;</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>        &lt;include file="$(find turtlebot3_bringup)/launch/turtlebot3_rpicamera.launch"/&gt;</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>    &lt;/group&gt;</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>&lt;/launch&gt; </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Compile your workspace. (You must be at the root of your workspace (<code>/home/ubuntu/catkin_ws/</code>)). This might not be needed but it is just to make sure all packages are well taken into account.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>[turtlebot-terminal] catkin_make</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>On your local computer, start roscore the navigation using the corresponding launch file. It will start roscore, rviz and a default map. (You might want to run roscore in a distinct terminal …)</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal1] roscore</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>[localpc-terminal2] roslaunch turtlebot3_navigation turtlebot3_navigation.launch</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Finally, on the robot, start the launcher that includes the usb camera</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>[turtlebot-terminal] roslaunch turtlebot3_bringup turtlebot3_robot_usbcam.launch</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>On your local computer, on the rviz navigation interface, enable Image and then select the <strong>right topic</strong> and the type to “compressed data” (red square on the image below). You should now be able to see the live stream provided by your camera on the bottom left part of the interface (thumbs up).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/rviz_usbcam.png" class="img-fluid figure-img" style="width:80.0%" data-margin="auto"></p>
<figcaption>Rviz interface with camera stream enabled. Pay attention to the topic selected and the type.</figcaption>
</figure>
</div></li>
</ol>
</section>
</section>
<section id="useful-commands" class="level2">
<h2 class="anchored" data-anchor-id="useful-commands">Useful commands</h2>
<div class="sourceCode" id="cb70"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>[turtlebot-terminal] v4l2-ctl --list-devices</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="referenced-links" class="level2">
<h2 class="anchored" data-anchor-id="referenced-links">Referenced links</h2>
<p>[1] <a href="https://wiki.ros.org/catkin/Tutorials/create_a_workspace" class="uri">https://wiki.ros.org/catkin/Tutorials/create_a_workspace</a></p>
<p>[2] <a href="https://wiki.ros.org/catkin" class="uri">https://wiki.ros.org/catkin</a></p>
<p>[3] <a href="http://wiki.ros.org/roslaunch/XML" class="uri">http://wiki.ros.org/roslaunch/XML</a></p>
<p>[4] <a href="http://wiki.ros.org/turtlebot3" class="uri">http://wiki.ros.org/turtlebot3</a></p>
</section>
</section>
<section id="commands-cheat-sheet" class="level1">
<h1>Commands cheat sheet</h1>
<p>Below, we provide a list of some useful and frequently used commands when using ROS and the Turtlebot3.</p>
<section id="on-computer" class="level2">
<h2 class="anchored" data-anchor-id="on-computer">On computer:</h2>
<section id="simulation" class="level3">
<h3 class="anchored" data-anchor-id="simulation">Simulation</h3>
<ul>
<li><p>Start gazebo simulator with the turtebot3 world</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] roslaunch turtlebot3_gazebo turtlebot3_world.launch</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Start teleop</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] roslaunch turtlebot3_teleop turtlebot3_teleop_key.launch</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="real-robots" class="level3">
<h3 class="anchored" data-anchor-id="real-robots">Real robots</h3>
<ul>
<li><p>Start roscore</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] roscore</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Start teleop node</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] roslaunch turtlebot3_teleop turtlebot3_teleop_key.launch</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Start Rviz visualizer (to visualize robot and its data)</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal-2] roslaunch turtlebot3_bringup turtlebot3_model.launch</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Start SLAM node</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] roslaunch turtlebot3_slam turtlebot3_slam.launch</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Save a map (created using the SLAM algorithm)</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] rosrun map_server map_saver -f ~/A428_test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Edit SLAM parameters</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] sudo nano /opt/ros/noetic/share/turtlebot3_slam/config/gmapping_params.yaml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Start navigation (loading an existing map given in parameter)</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>[localpc-terminal] roslaunch turtlebot3_navigation turtlebot3_navigation.launch map_file:=/home/nomis/A428_test.yaml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
</section>
<section id="on-the-real-robot-through-ssh" class="level2">
<h2 class="anchored" data-anchor-id="on-the-real-robot-through-ssh">On the real robot (through ssh)</h2>
<ul>
<li><p>Start the robot</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>[turtlebot-terminal]  roslaunch turtlebot3_bringup turtlebot3_robot.launch</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Start the robot (with the USB cam, assuming you set it up)</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>[turtlebot-terminal] roslaunch turtlebot3_bringup turtlebot3_robot_usbcam.launch</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>